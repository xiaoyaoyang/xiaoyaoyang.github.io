<!DOCTYPE html>
<meta charset="utf-8">
<html>
  <head>
    <style>
      svg {
        margin-left: 50px;
        width: 1200px;
        height: 500px;
        border: 1px solid gray;
      }

      #dropdown{
        margin-left: 50px;
      }

      .axis {
        font-size: 10px;
      }
      .axis path {
        fill: none;
        stroke: #000000;
      }
      .axis .tick line {
        stroke: #000;
      }
      .title{text-align: center}
    </style>
  </head>
  <body>
    
    <h2 class="title">Interactive Graph for Loan Data</h2>
    <div id='dropdown'></div>
    <svg id='svg'></svg>
    <div id="display"></div>


    <script src="d3/d3.js"></script>
<!-- <script src="table.js"></script> -->

    <script>
      var display = d3.select("#display");

// add dropdown menu
      var groups = ['Select Variable', 'dti','credit_score','delinquency_in_2yrs','annual_income','total_account','revolving_balance','inquiry'];

      d3.select('#dropdown')
        .append("select")
        .selectAll("option")
        .data(groups)
        .enter()
        .append("option")
        .attr("value", function (d) {
            return d;
        })
        .text(function (d) {
            return d;
        });


      // read data
      d3.json("loandata_sample.json", function(err, loan) {
              var dat = loan;

            d3.select('select')
              .on("change", function () {
                
              var variable = this.options[this.selectedIndex].__data__;


              // use data in dropdown box
              dat.forEach(function(d) {
                  d.selectvar = d[variable];
                  d.varname=variable;
              });
          
          // delete previous graph when change variable
              console.log(dat);
              d3.selectAll(".xaxis").remove();
              d3.selectAll(".yaxis").remove();
              d3.selectAll(".ylab").remove();
              d3.selectAll("circle").remove();
              d3.selectAll("rect").remove();
              d3.selectAll("rect.events").remove();
              d3.selectAll("path").remove();
              d3.selectAll("line").remove();
              d3.selectAll(".brush").remove();
              d3.selectAll(".brushaxis").remove();
              // brush.clear().event(d3.select(".brush"));





              var display = d3.select("#display")

              // //table
              // var tdiv = display.append("div").classed("table", true)
              // var table = d3.chart.table()
              // table.data(data)
              // table(tdiv);

              var svg = d3.select("svg")
              //scatter plot
              var sgroup = svg.append("g")
                .attr("transform", "translate(50, 0)")
              var scatter = d3.chart.scatter()
              scatter.data(dat)
              scatter(sgroup)

              //histogram
              var hgroup = svg.append("g")
                .attr("transform", "translate(650, 0)")
              var histogram = d3.chart.histogram()
              histogram.data(dat)
              histogram(hgroup)


              //brush
              var bgroup = svg.append("g")
                .attr("transform", "translate(100, 430)")
              var brush = d3.chart.brush()
              brush
                .data(dat)
                .width(1000)
              brush(bgroup)

              brush.on("filter", function(filtered) {
                console.log("filtered", filtered);

                scatter.data(filtered);
                scatter.update();
                // table.data(filtered)
                // table.update();
                histogram.data(filtered)
                histogram.update();


              })

              // table.on("hover", function(hovered) {
              //   scatter.highlight(hovered)
              //   brush.highlight(hovered)
              // })
              scatter.on("hover", function(hovered) {
                // table.highlight(hovered)
                brush.highlight(hovered)
              })
              histogram.on("hover", function(hovered) {
                // table.highlight(hovered)
                scatter.highlight(hovered)
                brush.highlight(hovered)
              })
      
     });

});

    </script>

    <script src="js/scatter.js"></script>
    <script src="js/brush.js"></script>
    <script src="js/histogram.js"></script>


    <h4>Description:</h4>
      <ul>
          <li>Selet time zone using bottom time bar</li>
          <li>Size of circle represent loan amount</li>
          <li>Color of points represent default status</li>
          <li>histogram of variables along with scatter plot</li>
      </ul>
  </body>
</html>