<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="In God we trust, all others bring data.">

    <title>Hypothesis Test Sample Size and Power - Hi. I'm Xiaoyao</title>

    <link rel="canonical" href="http://xiaoyaoyang.github.io/2016/04/02/hypothesis-test-sample-size/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://xiaoyaoyang.github.io/feed.xml" title="" />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">XIAOYAO YANG</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
				
                

                <li>
                    <a href="/about/">About</a>
                </li>
				
                
                
				
                

                <li>
                    <a href="/contact/">Contact</a>
                </li>
				
                
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/post-bg-04.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Hypothesis Test Sample Size and Power</h1>
                    
                    <h2 class="subheading"></h2>
                    
                    <span class="meta">Posted by Xiaoyao Yang on April 2, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<p>These are all start from the moment when I saw the post: <a href="http://datapirates.blogspot.de/2016/03/why-ab-testing-sucks.html">http://datapirates.blogspot.de/2016/03/why-ab-testing-sucks.html</a>. It claims A/B test, which is exactly two-sample t test, is useless. Below is simulation running with R.</p>

<h2 id="lets-do-some-experiments">Lets do some experiments!</h2>

<p>First we generate two random vector a and b. In this case, average of <em>a</em> is 0.1467 while average of <em>b</em> is 0.19. Both vector a and b are made by binary element, and the ideal average of <em>a</em> is 0.15, while average of <em>b</em> is 0.2.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">#init
</span><span class="n">sample_s</span> <span class="o">&lt;</span><span class="m">-300</span>
<span class="n">b_threshold</span> <span class="o">&lt;-</span> <span class="m">20</span>
<span class="n">a_threshold</span> <span class="o">&lt;-</span> <span class="m">15</span>
<span class="n">set.seed</span><span class="p">(</span><span class="m">106</span><span class="p">)</span>
<span class="n">a</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">100</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="n">sample_s</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="n">T</span><span class="p">)</span><span class="o">&lt;</span><span class="n">a_threshold</span><span class="p">)</span><span class="o">*</span><span class="m">1</span>
<span class="n">b</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">100</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="n">sample_s</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="n">T</span><span class="p">)</span><span class="o">&lt;</span><span class="n">b_threshold</span><span class="p">)</span><span class="o">*</span><span class="m">1</span>
</code></pre>
</div>

<p>Next, lets do a simple two-sample t test.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">test</span> <span class="o">&lt;-</span> <span class="n">t.test</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">alternative</span> <span class="o">=</span> <span class="s2">"greater"</span><span class="p">)</span>
<span class="n">t</span> <span class="o">&lt;-</span> <span class="n">test</span><span class="o">$</span><span class="n">statistic</span>
<span class="n">degree</span> <span class="o">&lt;-</span> <span class="n">test</span><span class="o">$</span><span class="n">parameter</span>
<span class="n">sigma</span> <span class="o">&lt;-</span> <span class="n">sd</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span>
<span class="n">ncp</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">b_threshold</span><span class="o">-</span><span class="n">a_threshold</span><span class="p">)</span><span class="o">/</span><span class="m">100</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_s</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span>
<span class="n">power</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">-</span><span class="n">pt</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="n">degree</span><span class="p">,</span><span class="n">ncp</span><span class="o">=</span><span class="n">ncp</span><span class="p">)</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">
##p.value: 0.07829374 
##power: 0.3954021
</code></p>

<p>Here we got p value = 0.07, if we set type I error threshold to 0.05, we can not reject the Null hypothesis. However, does that means we should accept Null hypothesis and believe mean of vector <em>a</em> and <em>b</em> are same? <strong>No!</strong>. Maybe it is easy to understand this way: if we accept null hypothesis and believe there is no difference between <em>a</em> and <em>b</em>, we have <em>61%</em> to make a mistake (type II), while if we reject Null hypothesis now, we have ~7% to make mistake (type I). The reason why we control type I error is that we can’t take risk making that mistake. In another word, if we only have 300 samples each group and want to see if conversion rate improve or not, the answer should be <strong>NO</strong>.</p>

<p>Next, lets calculate the possible maximum power given alpha, sample size, alternative (or effect size?) under normal assumption. Below is the power and Null/alternative distribution. We can see that power reach 80% when we have more than 690 samples (in each group), and it is obvious 300 samples is not enough. Also, we can see that actually when we have 300 samples in each group, the distribution charts is close. Frankly speaking, two sample mean hypothesis is nothing but compare mean of two samples, taking variance, central limit theroem into consideration and use distribution to measure the probability.</p>

<p><img src="/figure/source/2016-04-02-hypothesis-test-sample-size/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /></p>

<p><code class="highlighter-rouge">
## power (sample size = 690): 0.7984382
</code></p>

<p><img src="/figure/source/2016-04-02-hypothesis-test-sample-size/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /></p>

<p><code class="highlighter-rouge">
## power (sample size = 300): 0.4959953
</code></p>

<p><img src="/figure/source/2016-04-02-hypothesis-test-sample-size/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3" /></p>

<p>Actually, what the author in that post is doing, is similar to calculating the power of the test. Since power of test is that: under assumption that alternative hypothesis is correct, the probability of rejecting Null hypothesis. He run 100 simulation and found out ~50% reject and ~50% accept, which is near the power 0.57 that we are seeing in the above graph.</p>

<p>R has built in function to calculate sample size given type I error(alpha), type II error(beta), expected mean difference (delta), and data standard deviation. I also include calculation by hand under normal assumption.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">#calculate sample size
</span><span class="n">alpha</span> <span class="o">&lt;-</span> <span class="m">0.05</span>
<span class="n">beta</span> <span class="o">&lt;-</span> <span class="m">0.2</span>
<span class="n">delta</span> <span class="o">&lt;-</span> <span class="m">0.05</span>
<span class="n">pool_sd</span> <span class="o">&lt;-</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">var</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="o">/</span><span class="m">2</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">&lt;-</span> <span class="n">qnorm</span><span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="m">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">,</span><span class="n">mean</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span><span class="n">sd</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">&lt;-</span> <span class="n">qnorm</span><span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="m">1</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span><span class="n">mean</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span><span class="n">sd</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
<span class="p">(</span><span class="n">ideal_sample_norm</span> <span class="o">&lt;-</span> <span class="m">2</span><span class="o">*</span><span class="p">(</span><span class="n">c1</span><span class="o">+</span><span class="n">c2</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="p">(</span><span class="n">delta</span><span class="o">/</span><span class="n">pool_sd</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="n">power.t.test</span><span class="p">(</span><span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="n">pool_sd</span><span class="p">,</span><span class="n">sig.level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">power</span><span class="o">=</span><span class="m">1</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s2">"two.sample"</span><span class="p">,</span><span class="n">alternative</span><span class="o">=</span><span class="s2">"one.sided"</span><span class="p">)</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">
## [1] 692.4188
</code></p>

<p><code class="highlighter-rouge">
## 
##      Two-sample t test power calculation 
## 
##               n = 693.0962
##           delta = 0.05
##              sd = 0.3741583
##       sig.level = 0.05
##           power = 0.8
##     alternative = one.sided
## 
## NOTE: n is number in *each* group
</code></p>

<h2 id="conclusion">Conclusion</h2>

<p>Statistical A/B test or hypothesis test, is a very good technique to solve real world problem. However, understanding more about underlying assumption and requirement is important in real world. In statistical world, there is no “yes or no”, only good or bad.</p>



                <hr>

                <ul class="pager">
                    
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <!-- <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li> -->
                <!--      -->
                    
                    <li>
                        <a href="https://linkedin.com/in/xiaoyaoyang">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/xiaoyaoyoung">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/xiaoyaoyang">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:robinxiaoyaoyang@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Xiaoyao Yang 2016</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
